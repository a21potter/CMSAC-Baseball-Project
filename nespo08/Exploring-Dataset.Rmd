---
title: "Baseball-R-Dataset"
author: "Nicholas Esposito and Amber Potter"
date: "7/6/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Dataset

```{r}
library(baseballr)
library(tidyverse)

statcast_data_all <- read_rds("data/statcast_data_clean.rds") %>%
  janitor::clean_names()
```
## TEMP: Filter for 2022

```{r}
statcast_data_2022 <- statcast_data_all %>%
  filter(game_year == "2022")
```


## EDA

```{r}
# Counts and percentages of variables by shift type and pitcher/batter matchups
statcast_data_2020_to_22 %>%
  filter(!if_fielding_alignment == "", !of_fielding_alignment == "") %>%
  #select(stand, p_throws, if_fielding_alignment, of_fielding_alignment) %>%
  count(stand, p_throws, if_fielding_alignment, of_fielding_alignment) %>%
  mutate(prob = n/sum(n))

# Counts and percentages of variables by combination of shift type and pitcher/batter matchups
statcast_data_2020_to_22 %>%
  filter(!if_fielding_alignment == "", !of_fielding_alignment == "") %>%
  mutate(if_fielding_alignment = case_when(if_fielding_alignment == "Infield shift" ~ "Shift",
                                           if_fielding_alignment == "Strategic" ~ "Shift",
                                           if_fielding_alignment == "Standard" ~ "Standard")) %>%
  mutate(of_fielding_alignment = case_when(of_fielding_alignment == "4th outfielder" ~ "Shift",
                                           of_fielding_alignment == "Strategic" ~ "Shift",
                                           of_fielding_alignment == "Standard" ~ "Standard")) %>%
  #select(stand, p_throws, if_fielding_alignment, of_fielding_alignment) %>%
  count(stand, p_throws, if_fielding_alignment, of_fielding_alignment) %>%
  mutate(prob = n/sum(n))

# Table by pitcher/batter matchups (regardless of shift type)
statcast_data_2020_to_22 %>%
  #select(stand, p_throws, if_fielding_alignment, of_fielding_alignment) %>%
  count(stand, p_throws) %>%
  mutate(prob = n/sum(n))

# Prelim. spray charts
# statcast_data_2020_to_22 %>%
#   filter(game_year == 2022) %>%
#   ggspraychart("hc_x", "-hc_y", bin_size = 100, point_alpha = 0.25, frame = TRUE) +
#   facet_wrap(~stand)

# Group by player
statcast_data_2020_to_22 %>%
  group_by(player_name, stand) %>%
  mutate(count = n()) %>%
  filter(count > 480) %>% # ~ 480 at-bats
  count()
```
## Explore percentages
```{r}

# Create new variable - avg woba, avg babip, prop of Ks, prop of BBs
statcast_data_2022 %>%
  group_by(player_name) %>%
  filter(events != "") %>%
  mutate(walk = case_when(events == "walk" ~ 1,
                          TRUE ~ 0),
         strikeout = case_when(events = "strikeout" ~ 1,
                               TRUE ~ 0)) %>%
  summarize(stand, p_throws, if_fielding_alignment, of_fielding_alignment,
            bb_rate = count(events == "walk") / nrow(),
            k_rate = count(events == "strikeout") / nrow(),
            babip = mean(babip_value),
            woba = mean(woba_value))

# statcast_data_2022 %>%
#   group_by(stand, p_throws, if_fielding_alignment, of_fielding_alignment)
  
```

